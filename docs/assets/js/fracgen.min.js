/*! fracgen 2017-11-15 */

function Chromosone(){if(1!==arguments.length)throw new SyntaxError("Chromosone invalid arguments","chromosone.js");if(void 0===arguments[0])throw new TypeError("Chromosone undefined input","chromosone.js");if("Settings"===arguments[0].constructor.name){var a=arguments[0];this.iterationMax=generateValue(null,a.structure.iterationMax,a.fractal),this.zoom=generateValue(null,a.structure.zoom,a.fractal),this.moveX=generateValue(null,a.structure.moveX,a.fractal),this.moveY=generateValue(null,a.structure.moveY,a.fractal),"glynn_all"!==a.fractal&&"julia_quadratic"!==a.fractal||(this.cRe=generateValue(null,a.structure.cRe,a.fractal),"julia_quadratic"===a.fractal?this.cIm=generateValue(null,a.structure.cIm,a.fractal):this.exp=generateValue(null,a.structure.exp,a.fractal)),"pallete"===a.color?(this.a=generateValue(null,a.structure.a,a.fractal),this.b=generateValue(null,a.structure.b,a.fractal),this.c=generateValue(null,a.structure.c,a.fractal),this.d=generateValue(null,a.structure.d,a.fractal)):(this.redStart=generateValue(null,a.structure.redStart,a.fractal),this.greenStart=generateValue(null,a.structure.greenStart,a.fractal),this.blueStart=generateValue(null,a.structure.blueStart,a.fractal),this.redSpeed=generateValue(null,a.structure.redSpeed,a.fractal),this.greenSpeed=generateValue(null,a.structure.greenSpeed,a.fractal),this.blueSpeed=generateValue(null,a.structure.blueSpeed,a.fractal))}else{var b=arguments[0];this.iterationMax=b.iterationMax,this.zoom=b.zoom,this.moveX=b.moveX,this.moveY=b.moveY,void 0!==b.cRe&&(this.cRe=b.cRe),void 0!==b.cIm&&(this.cIm=b.cIm),void 0!==b.exp&&(this.exp=b.exp),void 0===b.a?(this.redStart=b.redStart,this.greenStart=b.greenStart,this.blueStart=b.blueStart,this.redSpeed=b.redSpeed,this.greenSpeed=b.greenSpeed,this.blueSpeed=b.blueSpeed):(this.a=new Vec3(b.a),this.b=new Vec3(b.b),this.c=new Vec3(b.c),this.d=new Vec3(b.d))}}function generateValue(a,b,c){if("vec3"===b.type)return new Vec3;var d=0,e=b.limit[c].min,f=Math.abs(b.limit[c].min)+Math.abs(b.limit[c].max),g=e+f;if("random"===b.method||null===a)d="random"===b.method&&"exp"===b.distribution?randomExp(e,g):random(e,g);else do{d=a+Math.random()*f*random(-b.intensity,b.intensity)}while(d<b.limit[c].min||d>b.limit[c].max);return"integer"===b.type&&(d=Math.round(d)),d}function equalChromosones(a,b,c){if(a.iterationMax!==b.iterationMax||a.zoom!==b.zoom||a.moveX!==b.moveX||a.moveY!==b.moveY)return!1;if("julia_quadratic"===c.fractal){if(a.cRe!==b.cRe||a.cIm!==b.cIm)return!1}else if("glynn_all"===c.fractal&&(a.cRe!==b.cRe||a.exp!==b.exp))return!1;return!!("pallete"!==c.color||a.a.equals(b.a)&&a.b.equals(b.b)&&a.c.equals(b.c)&&a.d.equals(b.d))&&(a.redStart===b.redStart&&a.greenStart===b.greenStart&&a.blueStart===b.blueStart&&a.redSpeed===b.redSpeed&&a.greenSpeed===b.greenSpeed&&a.blueSpeed===b.blueSpeed)}function random(a,b){return Math.random()*(b-a)+a}function randomExp(a,b){return Math.pow(Math.random(),2)*(b-a)+a}function Rect(){var a=0,b=0,c=0,d=0;4===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]):2===arguments.length&&(a=arguments[0].x,b=arguments[0].y,c=arguments[1].x,d=arguments[1].y),this.x=a,this.y=b,this.width=c,this.height=d}function Vec2(){var a=0,b=0;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(1===arguments.length){var c=arguments[0];void 0!==c&&(a=c.x,b=c.y)}this.x=a,this.y=b}function Vec3(){var a=0,b=0,c=0;if(3===arguments.length)a=arguments[0],b=arguments[1],c=arguments[2];else if(1===arguments.length){var d=arguments[0];void 0!==d&&(a=d.x,b=d.y,c=d.z)}else a=Math.random(),b=Math.random(),c=Math.random();this.x=a,this.y=b,this.z=c}function pallete(a,b,c,d,e){if("number"!=typeof a&&"object"!=typeof b&&"object"!=typeof c&&"object"!=typeof d&&"object"!=typeof e)throw new TypeError("pallete wrong arguments","vector.js");return new Vec3(d).mul(a).add(e).mul(2*Math.PI).cos().mul(c).add(b).toRGB()}Chromosone.prototype.mutate=function(a){var b=a.structure;Math.random()<=b.iterationMax.chance&&(this.iterationMax=generateValue(this.iterationMax,b.iterationMax,a.fractal)),Math.random()<=b.zoom.chance&&(this.zoom=generateValue(this.zoom,b.zoom,a.fractal)),Math.random()<=b.moveX.chance&&(this.moveX=generateValue(this.moveX,b.moveX,a.fractal)),Math.random()<=b.moveY.chance&&(this.moveY=generateValue(this.moveY,b.moveY,a.fractal)),"glynn_all"!==a.fractal&&"julia_quadratic"!==a.fractal||(Math.random()<=b.cRe.chance&&(this.cRe=generateValue(this.cRe,b.cRe,a.fractal)),"julia_quadratic"===a.fractal?Math.random()<=b.cIm.chance&&(this.cIm=generateValue(this.cIm,b.cIm,a.fractal)):Math.random()<=b.exp.chance&&(this.exp=generateValue(this.exp,b.exp,a.fractal))),"pallete"===a.color?(Math.random()<=b.a.chance&&(this.a=new Vec3),Math.random()<=b.b.chance&&(this.b=new Vec3),Math.random()<=b.c.chance&&(this.c=new Vec3),Math.random()<=b.d.chance&&(this.d=new Vec3)):(Math.random()<=b.redStart.chance&&(this.redStart=generateValue(this.redStart,b.redStart,a.fractal)),Math.random()<=b.greenStart.chance&&(this.greenStart=generateValue(this.greenStart,b.greenStart,a.fractal)),Math.random()<=b.blueStart.chance&&(this.blueStart=generateValue(this.blueStart,b.blueStart,a.fractal)),Math.random()<=b.redSpeed.chance&&(this.redSpeed=generateValue(this.redSpeed,b.redSpeed,a.fractal)),Math.random()<=b.greenSpeed.chance&&(this.greenSpeed=generateValue(this.greenSpeed,b.greenSpeed,a.fractal)),Math.random()<=b.blueSpeed.chance&&(this.blueSpeed=generateValue(this.blueSpeed,b.blueSpeed,a.fractal)))},Vec3.prototype.sin=function(){return this.x=Math.sin(this.x),this.y=Math.sin(this.y),this.z=Math.sin(this.z),this},Vec3.prototype.cos=function(){return this.x=Math.cos(this.x),this.y=Math.cos(this.y),this.z=Math.cos(this.z),this},Vec3.prototype.add=function(a){return"number"==typeof a?(this.x+=a,this.y+=a,this.z+=a):(this.x+=a.x,this.y+=a.y,this.z+=a.z),this},Vec3.prototype.sub=function(a){return"number"==typeof a?(this.x+=-a,this.y+=-a,this.z+=-a):(this.x+=-a.x,this.y+=-a.y,this.z+=-a.z),this},Vec3.prototype.mul=function(a){return"number"==typeof a?(this.x*=a,this.y*=a,this.z*=a):(this.x*=a.x,this.y*=a.y,this.z*=a.z),this},Vec3.prototype.mod=function(a){return"number"==typeof a?(this.x%=a,this.y%=a,this.z%=a):(this.x%=a.x,this.y%=a.y,this.z%=a.z),this},Vec3.prototype.toRGB=function(){return this.x=Math.round(255*this.x),this.y=Math.round(255*this.y),this.z=Math.round(255*this.z),this},Vec3.prototype.equals=function(a){return"object"==typeof a&&(this===a||this.x===a.x&&this.y===a.y&&this.z===a.z)};var evo={canvas:[],generated:0,worker:[],palleter:[],entropy:[],selected:null,lock:!1,checkRequirements:function(){return"undefined"==typeof Storage?(this.ui.addAlertMessage("alert-danger","Error!","This browser doesn't support localstorage needed for application run."),!1):"undefined"!=typeof Worker||(this.ui.addAlertMessage("alert-danger","Error!","This browser doesn't support Web Worker needed for application run."),!1)},init:function(){if(!this.lock){this.lock=!0,this.ui.init();for(var a=0;a<9;a++)this.canvas[a]=document.getElementById(a.toString()),this.canvas[a].height=this.canvas[a].width/4*3,this.worker[a]=new Worker("assets/js/fractaler.js"),this.worker[a].onmessage=this.processWorkerMessage;this.palleter=new Worker("assets/js/palleter.js"),this.palleter.onmessage=function(a){var b=document.getElementById("details-pallete"),c=b.getContext("2d"),d=c.createImageData(b.width,b.height);d.data.set(a.data.imageData),c.putImageData(d,0,0)},this.lock=!1,this.generate(),this.hideSelect()}},generateNew:function(){this.lock?this.ui.addAlertMessage("alert-danger","Error!","Please wait until new fractals are generated before reseting."):(this.ui.resetIteration(),this.hideSelect(),this.generate())},generate:function(){if(!this.lock){this.lock=!0,this.ui.hiddable.addClass("hidden"),this.ui.lockable.prop("disabled",!0),this.ui.lockable.addClass("list-item-disabled");$("#"+this.selected).parent().addClass("locked"),this.generated=0,this.ui.updateCounter();for(var a=0;a<9;a++)a!==this.selected?(this.ui.clearCanvas(a),this.ui.spinner[a].spin(document.getElementById(a).parentNode),this.generateFractal(a)):(this.generated++,this.ui.updateCounter());this.settings.iteration++,this.ui.updateIterator(),this.settings.historyInsert(),this.ui.updateHistory()}},generateFractal:function(a){if(null===this.selected)this.settings.chromosone[a]=new Chromosone(this.settings);else{for(var b=new Chromosone(this.settings.chromosone[this.selected]);equalChromosones(this.settings.chromosone[this.selected],b,this.settings);)b.mutate(this.settings);this.settings.chromosone[a]=b}this.drawChromosone(a,null,null)},drawChromosone:function(a,b,c,d){d=void 0!==d&&d;var e=new Chromosone(this.settings.chromosone[a]);e.fractalId=d||a,e.resolution=new Vec2(null===b?this.canvas[a].width:b,null===c?this.canvas[a].height:c),e.fractal=this.settings.fractal,e.color=this.settings.color,e.start=new Vec3(e.redStart,e.greenStart,e.blueStart),e.speed=new Vec3(e.redSpeed,e.greenSpeed,e.blueSpeed),"preview"===d&&(e.limit=new Vec2(evo.settings.structure.moveX.limit[this.settings.fractal].center,evo.settings.structure.moveY.limit[this.settings.fractal].center));var f="hd"===d||"preview"===d?0:a;this.worker[f].postMessage(e)},drawCustomChromosone:function(a){evo.worker[0].postMessage(a)},select:function(a){if(!this.lock)if(a===this.selected)this.hideSelect();else{null!==this.selected&&$("#"+this.selected).parent().removeClass("active"),this.selected=a,$("#"+a).parent().addClass("active"),this.ui.details.empty(),$('<canvas id="preview-canvas" style="width: 150px; height: 150px"></canvas>').appendTo(this.ui.details),this.drawChromosone(a,150,150,"preview");var b=$('<table style="margin: 0 auto;"></table>').appendTo(this.ui.details),c=this.settings.chromosone[this.selected];b.append("<tr><td class='table-label'>Iterations</td><td>"+c.iterationMax+"</td></tr>"),b.append("<tr><td class='table-label'>Zoom</td><td>"+c.zoom.toFixed(4)+"</td></tr>"),b.append("<tr><td class='table-label'>X</td><td>"+c.moveX.toFixed(4)+"</td></tr>"),b.append("<tr><td class='table-label'>Y</td><td>"+c.moveY.toFixed(4)+"</td></tr>"),void 0!==c.cRe&&b.append("<tr><td class='table-label'>cRe</td><td>"+c.cRe.toFixed(4)+"</td></tr>"),void 0!==c.cIm&&b.append("<tr><td class='table-label'>cIm</td><td>"+c.cIm.toFixed(4)+"</td></tr>"),void 0!==c.exp&&b.append("<tr><td class='table-label'>Exp</td><td>"+c.exp.toFixed(4)+"</td></tr>"),b.append("<tr><td class='table-label'>Pallete</td><td><canvas class='pallete' id='details-pallete'></canvas></td></tr>");var d,e=document.getElementById("details-pallete");d="pallete"===this.settings.color?{width:e.width,height:e.height,color:evo.settings.color,iterations:c.iterationMax,a:c.a,b:c.b,c:c.c,d:c.d}:{width:e.width,height:e.height,color:evo.settings.color,iterations:c.iterationMax,start:new Vec3(c.redStart,c.greenStart,c.blueStart),speed:new Vec3(c.redSpeed,c.greenSpeed,c.blueSpeed)},this.palleter.postMessage(d),b.append("<tr><td class='table-label'>Entropy</td><td>"+this.entropy[this.selected].toFixed(4)+"</td></tr>"),this.ui.hiddable.removeClass("hidden"),this.ui.lockable.removeClass("list-item-disabled"),this.ui.lockable.prop("disabled",!1),this.ui.command.innerHTML="&nbsp;"}},hideSelect:function(){null!==this.selected&&$("#"+this.selected).parent().removeClass("active"),this.ui.hiddable.addClass("hidden"),this.ui.lockable.addClass("list-item-disabled"),this.ui.lockable.prop("disabled",!0),this.ui.command.innerHTML="Select fractal you like",this.selected=null},processWorkerMessage:function(a){var b,c,d;"hd"===a.data.fractalId?(d=document.createElement("canvas"),d.width=a.data.resolution.x,d.height=a.data.resolution.y,b=d.getContext("2d"),c=b.createImageData(d.width,d.height),c.data.set(a.data.imageData),b.putImageData(c,0,0),evo.ui.popupWindow.location.href=d.toDataURL("image/png"),evo.ui.addAlertMessage("alert-info","Info","Fractal in HD resolution has been rendered into separate window.")):"preview"===a.data.fractalId?(d=document.getElementById("preview-canvas"),d.width=a.data.resolution.x,d.height=a.data.resolution.y,b=d.getContext("2d"),c=b.createImageData(a.data.resolution.x,a.data.resolution.y),c.data.set(a.data.imageData),b.putImageData(c,0,0)):!isNaN(a.data.fractalId)&&isFinite(a.data.fractalId)&&(a.data.entropy<=evo.settings.entropyLimit?evo.generateFractal(a.data.fractalId):(evo.entropy[a.data.fractalId]=a.data.entropy,b=evo.canvas[a.data.fractalId].getContext("2d"),c=b.createImageData(evo.canvas[a.data.fractalId].width,evo.canvas[a.data.fractalId].height),c.data.set(a.data.imageData),b.putImageData(c,0,0),evo.generated++,evo.ui.spinner[a.data.fractalId].stop(),evo.ui.updateCounter(),9===evo.generated&&($("#"+evo.selected).parent().removeClass("locked"),evo.hideSelect(),evo.lock=!1,evo.generated=0)))}};window.onload=function(){evo.checkRequirements()&&evo.init()},window.addEventListener("resize",function(){screen.width===window.innerWidth&&evo.ui.isFullScreen()}),Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},Storage.prototype.getObject=function(a){var b=this.getItem(a);return void 0!==b&&null!==b&&JSON.parse(b)},evo.settings={constructor:{name:"Settings"},chromosone:[],history:[],historyCursor:0,entropyLimit:7,fractal:"mandelbroot_quadratic",color:"simple",debugMode:!0,iteration:0,historyInsert:function(){this.history=this.history.slice(0,this.historyCursor+1),this.history.push(JSON.parse(JSON.stringify(this.prepareSaveObject()))),this.historyCursor=this.history.length-1,console.log(this.history),console.log(this.historyCursor)},historyBackward:function(){this.historyCursor--,this.load(this.history[this.historyCursor])},historyForward:function(){this.historyCursor++,this.load(this.history[this.historyCursor])},prepareSaveObject:function(){return{chromosone:evo.settings.chromosone,entropyLimit:evo.settings.entropyLimit,fractal:evo.settings.fractal,color:evo.settings.color,iteration:evo.settings.iteration}},loadSavedObject:function(a){this.chromosone=a.chromosone,this.entropyLimit=a.entropyLimit,this.fractal=a.fractal,this.color=a.color,this.iteration=a.iteration},saveToLocalStorage:function(a){var b=localStorage.getObject("saves");void 0!==b&&Array.isArray(b)||(b=[]),b.push({name:a,data:this.prepareSaveObject()}),console.log(b),localStorage.setObject("saves",b)},loadFromLocalStorage:function(a){var b=localStorage.getObject("saves");void 0===b&&evo.ui.addAlertMessage("alert-danger","Error!","Save not found");var c=b[a].data;void 0===c&&evo.ui.addAlertMessage("alert-danger","Error!","Save not found"),this.load(c)},load:function(a){if(!evo.lock&&void 0!==a&&(evo.lock=!0,this.checkSave())){this.loadSavedObject(a),evo.hideSelect();for(var b=0;b<9;b++)evo.ui.clearCanvas(b),evo.ui.spinner[b].spin(document.getElementById(b).parentNode),evo.drawChromosone(b,null,null);evo.ui.update()}},getSavedObjects:function(){var a=localStorage.getObject("saves");return void 0!==a&&Array.isArray(a)?a:[]},checkSave:function(){return void 0!==localStorage.getObject("settings")}},evo.settings.structure={iterationMax:{method:"random",distribution:"uniform",type:"integer",chance:.45,limit:{mandelbroot_quadratic:{min:100,max:3e3},mandelbroot_cubic:{min:100,max:300},julia_quadratic:{min:100,max:3e3},glynn_all:{min:200,max:500}},include:function(){return!0}},zoom:{method:"step",intensity:1,type:"float",chance:.6,limit:{mandelbroot_quadratic:{min:1,max:400},mandelbroot_cubic:{min:1,max:300},julia_quadratic:{min:1,max:100},glynn_all:{min:1,max:20}},include:function(){return!0}},moveX:{method:"step",intensity:1,type:"float",chance:.6,limit:{mandelbroot_quadratic:{min:-1,max:1,center:-.5},mandelbroot_cubic:{min:.3,max:.6,center:-.25},julia_quadratic:{min:-1,max:1,center:0},glynn_all:{min:-1,max:1,center:0}},include:function(){return!0}},moveY:{method:"step",intensity:1,type:"float",chance:.6,limit:{mandelbroot_quadratic:{min:-1,max:1,center:0},mandelbroot_cubic:{min:-.3,max:.3,center:0},julia_quadratic:{min:-1,max:1,center:0},glynn_all:{min:-1,max:1,center:0}},include:function(){return!0}},cRe:{method:"step",intensity:1,type:"float",chance:.6,limit:{julia_quadratic:{min:-1,max:1},glynn_all:{min:-.5,max:0}},include:function(){return"glynn_all"===evo.settings.fractal||"julia_quadratic"===evo.settings.fractal}},cIm:{method:"step",intensity:1,type:"float",chance:.6,limit:{julia_quadratic:{min:0,max:1}},include:function(){return"julia_quadratic"===evo.settings.fractal}},exp:{method:"step",intensity:1,type:"float",chance:.6,limit:{glynn_all:{min:1,max:2}},include:function(){return"glynn_all"===evo.settings.fractal}},redStart:{method:"random",distribution:"uniform",type:"integer",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:125},mandelbroot_cubic:{min:0,max:125},julia_quadratic:{min:0,max:125},glynn_all:{min:0,max:125}},include:function(){return"pallete"!==evo.settings.color}},greenStart:{method:"random",distribution:"uniform",type:"integer",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:125},mandelbroot_cubic:{min:0,max:125},julia_quadratic:{min:0,max:125},glynn_all:{min:0,max:125}},include:function(){return"pallete"!==evo.settings.color}},blueStart:{method:"random",distribution:"uniform",type:"integer",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:125},mandelbroot_cubic:{min:0,max:125},julia_quadratic:{min:0,max:125},glynn_all:{min:0,max:125}},include:function(){return"pallete"!==evo.settings.color}},redSpeed:{method:"random",distribution:"uniform",type:"floatr",chance:.45,limit:{mandelbroot_quadratic:{min:-2,max:2},mandelbroot_cubic:{min:-2,max:2},julia_quadratic:{min:-2,max:2},glynn_all:{min:-2,max:2}},include:function(){return"pallete"!==evo.settings.color}},greenSpeed:{method:"random",distribution:"uniform",type:"floatr",chance:.45,limit:{mandelbroot_quadratic:{min:-2,max:2},mandelbroot_cubic:{min:-2,max:2},julia_quadratic:{min:-2,max:2},glynn_all:{min:-2,max:2}},include:function(){return"pallete"!==evo.settings.color}},blueSpeed:{method:"random",distribution:"uniform",type:"floatr",chance:.45,limit:{mandelbroot_quadratic:{min:-2,max:2},mandelbroot_cubic:{min:-2,max:2},julia_quadratic:{min:-2,max:2},glynn_all:{min:-2,max:2}},include:function(){return"pallete"!==evo.settings.color}},a:{type:"vec3",method:"random",distribution:"uniform",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:1},mandelbroot_cubic:{min:0,max:1},julia_quadratic:{min:0,max:1},glynn_all:{min:0,max:1}},include:function(){return"pallete"===evo.settings.color}},b:{type:"vec3",method:"random",distribution:"uniform",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:1},mandelbroot_cubic:{min:0,max:1},julia_quadratic:{min:0,max:1},glynn_all:{min:0,max:1}},include:function(){return"pallete"===evo.settings.color}},c:{type:"vec3",method:"random",distribution:"uniform",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:1},mandelbroot_cubic:{min:0,max:1},julia_quadratic:{min:0,max:1},glynn_all:{min:0,max:1}},include:function(){return"pallete"===evo.settings.color}},d:{type:"vec3",method:"random",distribution:"uniform",chance:.45,limit:{mandelbroot_quadratic:{min:0,max:1},mandelbroot_cubic:{min:0,max:1},julia_quadratic:{min:0,max:1},glynn_all:{min:0,max:1}},include:function(){return"pallete"===evo.settings.color}}},evo.ui={iterationSpan:null,command:null,details:null,settings:null,load:null,custom:null,popupWindow:null,customForm:null,hiddable:null,lockable:null,exportDialog:null,exportData:null,importDialog:null,importData:null,saveManagerDialog:null,saveManagerTableBody:null,saveName:null,loadManagerDialog:null,loadManagerTableBody:null,historyBackward:null,historyForward:null,spinner:[],init:function(){this.iterationSpan=document.getElementById("iteration"),this.command=document.getElementById("command"),this.details=$("#details"),this.settings=$("#settingsDialog"),this.load=$("#load"),this.custom=$("#saveCustomDialog"),this.customForm=$("#saveCustom"),this.hiddable=$(".hiddable"),this.lockable=$(".lockable"),this.exportDialog=$("#exportDialog"),this.exportData=$("#exportData"),this.importDialog=$("#importDialog"),this.importData=$("#importData"),this.saveManagerDialog=$("#saveManagerDialog"),this.saveName=$("#saveName"),this.saveManagerTableBody=$("#saveManagerTableBody"),this.loadManagerDialog=$("#loadManagerDialog"),this.loadManagerTableBody=$("#loadManagerTableBody"),this.historyBackward=$("#historyBackward"),this.historyForward=$("#historyForward");for(var a=0;a<9;a++)this.spinner[a]=new Spinner;this.update()},updateHistory:function(){evo.settings.historyCursor<evo.settings.history.length-1?(this.historyForward.removeClass("list-item-disabled"),this.historyForward.prop("disabled",!1)):(this.historyForward.addClass("list-item-disabled"),this.historyForward.prop("disabled",!0)),evo.settings.historyCursor>0?(this.historyBackward.removeClass("list-item-disabled"),this.historyBackward.prop("disabled",!1)):(this.historyBackward.addClass("list-item-disabled"),this.historyBackward.prop("disabled",!0))},clearCanvas:function(a){var b=evo.canvas[a].getContext("2d");b.fillStyle="#FFFFFF",b.fillRect(0,0,evo.canvas[a].width,evo.canvas[a].height)},update:function(){evo.settings.debugMode?$(".debug[class=hide]").removeClass("hide"):$(".debug[class!=hide]").addClass("hide"),evo.settings.checkSave()||this.load.addClass("hide"),evo.ui.updateIterator(),evo.ui.updateHistory()},openSettings:function(){evo.lock?this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated"):($("#color[name=color][value="+evo.settings.color+"]").prop("checked",!0),$("#fractal[name=color][value="+evo.settings.fractal+"]").prop("checked",!0),$("#debug_mode").prop("checked",evo.settings.debugMode),this.settings.modal("show"))},saveSettings:function(){var a=$("input[name=color]:checked","#settingsDialog").val(),b=$("input[name=fractal]:checked","#settingsDialog").val(),c=!1;a!==evo.settings.color&&(evo.settings.color=a,c=!0),b!==evo.settings.fractal&&(evo.settings.fractal=b,c=!0),evo.settings.debugMode=$("#debug_mode").is(":checked"),evo.settings.debugMode&&this.update(),c&&evo.generateNew()},openCustom:function(){evo.lock&&this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated"),this.custom.modal("show")},updateCounter:function(){this.command.innerHTML="Generating "+evo.generated+"/9"},updateIterator:function(){this.iterationSpan.innerHTML=evo.settings.iteration},resetIteration:function(){evo.settings.iteration=1,this.iterationSpan.innerHTML=evo.settings.iteration},isFullScreen:function(){$(".fullscreen").css("display","none")},saveImage:function(a,b){this.popupWindow=window.open("waiting.html","_blank"),evo.drawChromosone(evo.selected,a,b,"hd")},saveCustom:function(){this.popupWindow=window.open("waiting.html","_blank");var a={};a.fractalId="hd",a.iterationMax=parseInt(this.customForm.find("input[name=iterations]").val()),a.zoom=parseFloat(this.customForm.find("input[name=zoom]").val()),a.moveX=parseFloat(this.customForm.find("input[name=x]").val()),a.moveY=parseFloat(this.customForm.find("input[name=y]").val()),a.cRe=parseFloat(this.customForm.find("input[name=cRe]").val()),a.cIm=parseFloat(this.customForm.find("input[name=cIm]").val()),a.exp=parseFloat(this.customForm.find("input[name=exp]").val()),a.redStart=parseInt(this.customForm.find("input[name=redStart]").val()),a.greenStart=parseInt(this.customForm.find("input[name=greenStart]").val()),a.blueStart=parseInt(this.customForm.find("input[name=blueStart]").val()),a.redSpeed=parseInt(this.customForm.find("input[name=redSpeed]").val()),a.greenSpeed=parseInt(this.customForm.find("input[name=greenSpeed]").val()),a.blueSpeed=parseInt(this.customForm.find("input[name=blueSpeed]").val()),a.width=parseInt(this.customForm.find("input[name=width]").val()),a.height=parseInt(this.customForm.find("input[name=height]").val()),a.resolution=new Vec2(a.width,a.height),a.fractal=this.customForm.find("input[name=fractal]:checked").val(),a.color=this.customForm.find("input[name=color]:checked").val(),a.start=new Vec3(a.redStart,a.greenStart,a.blueStart),a.speed=new Vec3(a.redSpeed,a.greenSpeed,a.blueSpeed),evo.drawCustomChromosone(a)},openExport:function(){if(evo.lock)return void this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated");this.exportData.val(JSON.stringify(evo.settings.prepareSaveObject())),this.exportDialog.modal("show")},openImport:function(){if(evo.lock)return void this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated");this.importDialog.modal("show")},onImportData:function(){evo.settings.load(JSON.parse(this.importData.val()))},openSaveManager:function(){if(evo.lock)return void this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated");this.saveManagerTableBody.find("tr").remove();for(var a=evo.settings.getSavedObjects(),b=0;b<a.length;b++)this.saveManagerTableBody.append('<tr style="cursor: pointer" class="saveRow" onclick="$(\'#saveName\').val(\''+a[b].name+"');\"><td>"+(b+1)+"</td>><td>"+a[b].name+"</td></tr>");this.saveManagerDialog.modal("show")},onNewSave:function(){evo.settings.saveToLocalStorage(this.saveName.val())},openLoadManager:function(){if(evo.lock)return void this.addAlertMessage("alert-danger","Error!","Please wait until fractals are generated");this.loadManagerTableBody.find("tr").remove();for(var a=evo.settings.getSavedObjects(),b=0;b<a.length;b++)this.loadManagerTableBody.append('<tr data-dismiss="modal" style="cursor: pointer" class="saveRow" onclick="evo.ui.onLoad(\''+b+"');\"><td>"+(b+1)+"</td>><td>"+a[b].name+"</td></tr>");this.loadManagerDialog.modal("show")},onLoad:function(a){evo.settings.loadFromLocalStorage(a)},addAlertMessage:function(a,b,c){var d=$('<div class="alert alert-dismissable fade-in"></div>');d.addClass(a),d.append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'),d.append("<strong>"+b+"</strong> "+c),$("#alert-overlay").prepend(d),$(d).fadeTo(6e3,500).slideUp(500,function(){$(d).alert("close")})}},evo.spionner={lines:13,length:28,width:14,radius:42,scale:1,corners:1,color:"#fff",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!0,hwaccel:!1,position:"absolute"};
